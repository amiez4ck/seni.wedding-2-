<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Troli Saya</title>
  <link rel="stylesheet" href="mobile-cart.css" media="only screen and (max-width: 768px)">
  <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-[#fdfaf6] text-gray-800 font-[Poppins]">
  <header class="bg-white border-b shadow-sm px-4 py-3 flex justify-between items-center relative z-50">
  <button class="mobile-nav-toggle block md:hidden" onclick="document.getElementById('mobileMenu').classList.toggle('show')">‚ò∞</button>

  <!-- Logo -->
  <a href="index.html" class="mx-auto">
    <img src="img/logo-.png" alt="Logo Seni Wedding HT" class="h-14 md:h-20 object-contain" data-aos="zoom-in" data-aos-delay="100">
  </a>

  <nav class="hidden md:flex items-center gap-6 text-sm relative">
   <a href="index.html" class="hover:underline" data-lang-my="Halaman Utama" data-lang-en="Home">Halaman Utama</a>
    <a href="produk.html" class="hover:underline" data-lang-my="Produk" data-lang-en="Product">Produk</a>
    <a href="catalog.html" class="hover:underline" data-lang-my="Katalog" data-lang-en="Catalog">Katalog</a>
    <a href="hubungi.html" class="hover:underline" data-lang-my="Hubungi" data-lang-en="Contact">Hubungi</a>
    <a href="cart.html" class="relative">
    üõí
    <span id="troliCount" class="absolute -top-2 -right-2 bg-pink-500 text-white rounded-full px-2 text-xs">0</span>
    </a>

  </nav>
</div>

  <nav id="mobileMenu" class="md:hidden">
  <a href="cart.html" id="troliIcon" data-lang-my="Troli üõí" data-lang-en="Shopping Cart üõí">Troli üõí</a>
  <a href="index.html" data-lang-my="Halaman Utama" data-lang-en="Home">Halaman Utama</a>
  <a href="produk.html" data-lang-my="Produk" data-lang-en="Product">Produk</a>
  <a href="catalog.html" data-lang-my="Katalog" data-lang-en="Catalog">Katalog</a>
  <a href="hubungi.html" data-lang-my="Hubungi" data-lang-en="Contact">Hubungi</a>
</nav>

<div class="language-toggle flex gap-2 text-sm items-center">
  <button onclick="setLanguage('my')" class="py-1 px-2 border rounded text-pink-500">MY</button>
  <span>|</span>
  <button onclick="setLanguage('en')" class="py-1 px-2 border rounded text-pink-500">EN</button>
</div>


</header>

  <section class="max-w-4xl mx-auto px-6 py-12">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-pink-600" data-lang-my="üõí Troli Pembelian Anda" data-lang-en="üõí Your Shopping Cart"">üõí Troli Pembelian Anda</h1>
      <a href="produk.html" class="text-sm text-pink-500 hover:underline" data-lang-my="‚Üê Kembali ke Produk" data-lang-en="‚Üê Back to Products">‚Üê Kembali ke Produk</a>
    </div>

    <ul id="senaraiTroli" class="space-y-4 mb-6"></ul>

    <div class="flex justify-between items-center border-t pt-4 mt-8">
      <p class="text-lg font-semibold text-sm text-gray-500 mb-1" data-lang-my="Jumlah Keseluruhan:" data-lang-en="Total :" >Jumlah Keseluruhan: <span id="totalHarga" class="text-pink-600 font-bold">RM0.00</span></p>
    </div>

    <div class="bg-white rounded-xl shadow p-6 mt-8">
      <h2 class="text-xl font-semibold text-pink-600 mb-4" data-lang-my="Maklumat Pelanggan" data-lang-en="Customer Information">Maklumat Pelanggan</h2>

      <form id="checkoutForm" class="space-y-4">
        <input type="text" id="nama" placeholder="Nama Penuh / Full Name" class="w-full border px-3 py-2 rounded" required>
        <input type="email" id="email" placeholder="Alamat Email / Email Address" class="w-full border px-3 py-2 rounded" required>

        <select id="lokasi" class="w-full border px-3 py-2 rounded" required>
          <option value="" data-lang-my="Pilih Negara" data-lang-en="Select Country">Pilih Negara</option>
          <option value="Malaysia">Malaysia</option>
          <option value="Singapore">Singapore</option>
        </select>

        <label class="block font-medium mt-4" data-lang-my="Warna Dasar (Pilih salah satu):" data-lang-en="Base Color (Choose one):">Warna Dasar (Pilih salah satu):</label>
        <select id="warnaDasar" class="w-full border px-3 py-2 rounded">
          <option value="Putih">Putih / White</option>
          <option value="Hitam">Hitam / Black</option>
          <option value="Gold">Gold / Emas</option>
          <option value="Rose Gold">Rose Gold</option>
          <option value="Coklat Kayu">Coklat Kayu / Brown Wood</option>
        </select>

        <label class="block font-medium mt-4" data-lang-my="Warna Pilihan Lain (Jika ada):" data-lang-en="Other Color (Optional):">Warna Pilihan Lain (Jika ada):</label>
        <input type="text" id="warnaCustom" placeholder="Contoh: Dusty pink + beige" class="w-full border px-3 py-2 rounded">

        <label class="block font-medium mt-4" data-lang-my="Tarikh Diperlukan:" data-lang-en="Date Required:">Tarikh Diperlukan:</label>
        <input type="date" id="tarikhPerlu" class="w-full border px-3 py-2 rounded" required>

        <label class="block font-medium mt-4" data-lang-my="Catatan Tambahan (Opsyenal):" data-lang-en="Additional Notes (Optional):">Catatan Tambahan (Opsyenal):</label>
        <textarea id="catatan" rows="3" class="w-full border px-3 py-2 rounded" placeholder="Contoh: Perlu segera, atau pos sebelum tarikh tertentu."></textarea>
        <!-- Wrapping Parcel Option -->
<label class="block font-medium mt-4" data-lang-my="Pembungkusan Selamat:" data-lang-en="Safe Wrapping Option:">Pembungkusan Selamat:</label>
<select id="wrapping" class="w-full border px-3 py-2 rounded">
  <option value="0" data-lang-my="Tiada (Percuma)" data-lang-en="None (Free)">Tiada (Percuma)</option>
  <option value="10" data-lang-my="Ya, Bungkus Selamat (Tambah RM10)" data-lang-en="Yes, Safety Wrapped (Add RM10)">Ya, Bungkus Selamat (Tambah RM10)</option>
</select>

<!-- Lokasi Penghantaran -->
<label class="block font-medium mt-4" data-lang-my="Kawasan Penghantaran:" data-lang-en="Shipping Region:">Kawasan Penghantaran:</label>
<select id="penghantaran" class="w-full border px-3 py-2 rounded">
  <option value="0" data-lang-my="Semenanjung Malaysia (RM0)" data-lang-en=" Malaysia (RM0)">Semenanjung Malaysia (RM0)</option>
  <option value="15" data-lang-my="Sabah & Sarawak (Tambah RM15)" data-lang-en="Sabah & Sarawak (Add RM15)">Sabah & Sarawak (Tambah RM15)</option>
  <option value="35" data-lang-my="Singapura (Tambah RM35)" data-lang-en="Singapore (Add RM35)">Singapura (Tambah RM35)</option>
</select>

<!-- Paparan Harga Produk dan Jumlah Keseluruhan -->
<div id="summaryHarga" class="bg-pink-50 border border-pink-200 text-sm text-gray-700 rounded p-4 mb-4 hidden">
  <p><strong>Jumlah Harga Produk:</strong> <span id="hargaProduk">RM0.00</span> / <span id="hargaProdukSGD">S$0.00</span></p>
  <p><strong>Wrapping Parcel:</strong> <span id="hargaWrapping">RM0.00</span>  / <span id="hargaWrappingSGD">S$0.00</span></p>
  <p><strong>Penghantaran:</strong> <span id="hargaPenghantaran">RM0.00</span> / <span id="hargaPenghantaranSGD">S$0.00</span></p>
  <p class="mt-2 text-pink-600 font-bold"><strong>Jumlah Keseluruhan:</strong> <span id="jumlahAkhir">RM0.00</span>  / <span id="jumlahAkhirSGD">S$0.00</span></p>
</div>

        <div class="flex justify-end gap-4">
          <button type="button" onclick="kosongkanTroli()" class="px-4 py-2 border border-red-500 text-red-500 rounded hover:bg-red-100">Kosongkan Troli</button>
          <button type="submit" class="px-4 py-2 bg-pink-600 text-white rounded hover:bg-pink-700">Checkout via WhatsApp</button>
        </div>
      </form>
    </div>
  </section>

  <script>
    const troli = JSON.parse(localStorage.getItem("troliProduk")) || [];
    const senaraiContainer = document.getElementById("senaraiTroli");
    const totalHargaEl = document.getElementById("totalHarga");

    function paparkanTroli() {
      const troli = JSON.parse(localStorage.getItem("troliProduk")) || [];
      senaraiContainer.innerHTML = "";
      let jumlahMyr = 0;
      let jumlahSgd = 0;

      if (troli.length === 0) {
        senaraiContainer.innerHTML = "<p class='text-gray-500'>Troli anda kosong.</p>";
        totalHargaEl.textContent = "RM0.00";
        return;
      }

      
  troli.forEach((item, index) => {
  const hargaMyr = parseFloat(item.harga_myr?.replace("RM", "") || "0");
  const hargaSgd = parseFloat(item.harga_sgd?.replace("S$", "") || "0");

jumlahMyr += hargaMyr;
jumlahSgd += hargaSgd;

  
  let totalAddonMyr = 0;
  let totalAddonSgd = 0;

  if (Array.isArray(item.addon) && item.addon.length > 0) {
    item.addon.forEach(add => {
      totalAddonMyr += parseFloat(add.value_myr || 0);
      totalAddonSgd += parseFloat(add.value_sgd || 0);
    });
  }

  const addonHTML = (item.addon && item.addon.length > 0)
    ? item.addon.map((a, i) => `
        <li class="text-sm text-gray-500 flex justify-between">
          <span>${a.label}</span>
          <button onclick="buangAddon(${index}, ${i})" class="text-xs text-red-500 hover:underline">Buang</button>
        </li>`).join('')
    : "<li class='text-sm text-gray-400'>Tiada Add-on</li>";

  const itemHtml = `
    <li class="bg-white shadow rounded p-4 flex items-start gap-4">
      <img src="${item.img}" alt="${item.nama}" class="w-24 h-24 object-cover rounded-md">
      <div class="flex-1">
        <p class="font-semibold">${item.nama}</p>
        <p class="text-sm text-gray-500">Harga Asal: ${item.harga_asal_myr} / ${item.harga_asal_sgd}</p>
        <p class="text-sm text-gray-500">Jumlah Add-On: RM${totalAddonMyr.toFixed(2)} / S$${totalAddonSgd.toFixed(2)}</p>
        <p class="text-sm text-pink-600 font-semibold">Jumlah Akhir: ${item.harga_myr} / ${item.harga_sgd}</p>
        <p class="text-sm font-medium mt-2">Add-On:</p>
        <ul>${addonHTML}</ul>
      </div>
      <button onclick="padamProduk(${index})" class="text-sm text-red-500 hover:underline">Padam</button>
    </li>
  `;

  senaraiContainer.innerHTML += itemHtml;
});


     totalHargaEl.textContent = `RM${jumlahMyr.toFixed(2)} / S$${jumlahSgd.toFixed(2)}`;
    }

    function padamProduk(index) {
      troli.splice(index, 1);
      localStorage.setItem("troliProduk", JSON.stringify(troli));
      paparkanTroli();
    }

    function kosongkanTroli() {
      if (confirm("Anda pasti mahu kosongkan troli?")) {
        localStorage.removeItem("troliProduk");
        location.reload();
      }
    }

    document.getElementById("checkoutForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const nama = document.getElementById("nama").value;
      const email = document.getElementById("email").value;
      const lokasi = document.getElementById("lokasi").value;
      const warnaDasar = document.getElementById("warnaDasar").value;
      const warnaCustom = document.getElementById("warnaCustom").value || "Tiada";
      const catatan = document.getElementById("catatan").value || "Tiada";
      const tarikh = document.getElementById("tarikhPerlu").value || "Tidak ditentukan";
      const wrappingCost = parseFloat(document.getElementById("wrapping").value || 0);
      const shippingCost = parseFloat(document.getElementById("penghantaran").value || 0);
      const jumlahAkhirMYR = troli.reduce((sum, item) => sum + parseFloat(item.harga_myr.replace("RM", "")), 0) + wrappingCost + shippingCost;


      if (troli.length === 0) {
        alert("Troli anda kosong.");
        return;
      }

      let mesej = `Tempahan Baru daripada ${nama} (${email})\n%`;
      mesej += `Lokasi: ${lokasi}\n%`;
      mesej += `Warna Dasar: ${warnaDasar}\n%`;
      mesej += `Warna Custom: ${warnaCustom}\n%`;
      mesej += `Tarikh Diperlukan: ${tarikh}\n%`;
      mesej += `Catatan Pelanggan: ${catatan}\n\n`;

      mesej += `Produk Dipilih*:%0A`;
      troli.forEach((item, index) => {
      mesej += `${index + 1}. ${item.nama}\n`;
      mesej += `   - Harga MYR: ${item.harga_myr}\n`;
      mesej += `   - Harga SGD: ${item.harga_sgd}\n\n`;
      });
      
      mesej += `üöö *Penghantaran*: RM${shippingCost.toFixed(2)}\n`;
      mesej += `üì¶ *Wrapping Parcel*: RM${wrappingCost.toFixed(2)}\n\n`;
      mesej += `üí∞ *Jumlah Keseluruhan (MYR)*: RM${jumlahAkhirMYR.toFixed(2)}\n\n`;


      mesej += `*Sila sahkan maklumat tempahan anda üòä*`;

      const whatsappLink = `https://wa.me/60134419744?text=${encodeURIComponent(mesej)}`;
      window.open(whatsappLink, "_blank");
      localStorage.removeItem("troliProduk");
    });


function buangAddon(indexProduk, indexAddon) {
  const troliSemasa = JSON.parse(localStorage.getItem("troliProduk")) || [];
  const produk = troliSemasa[indexProduk];

  if (!produk || !Array.isArray(produk.addon) || !produk.addon[indexAddon]) return;

  const addon = produk.addon[indexAddon];

  const nilaiMyr = parseFloat(addon.value_myr || 0);
  const nilaiSgd = parseFloat(addon.value_sgd || 0);

  const hargaMyrLama = parseFloat(produk.harga_myr.replace("RM", "")) || 0;
  const hargaSgdLama = parseFloat(produk.harga_sgd.replace("S$", "")) || 0;

  produk.harga_myr = `RM${(hargaMyrLama - nilaiMyr).toFixed(2)}`;
  produk.harga_sgd = `S$${(hargaSgdLama - nilaiSgd).toFixed(2)}`;

  produk.addon.splice(indexAddon, 1);

  troliSemasa[indexProduk] = produk;

  localStorage.setItem("troliProduk", JSON.stringify(troliSemasa));

  // ‚úÖ Panggil semula fungsi utama untuk kemas kini paparan
  paparkanTroli();
}


paparkanTroli();


function kiraJumlahAkhirPaparan() {
  const wrappingCost = parseFloat(document.getElementById("wrapping").value || 0);
  const wrappingCostSGD = wrappingCost / 3.3;
  const shippingCost = parseFloat(document.getElementById("penghantaran").value || 0);
  const shippingCostSGD = shippingCost / 3.3;
  const troli = JSON.parse(localStorage.getItem("troliProduk")) || [];
  const jumlahProduk = troli.reduce((sum, item) => sum + parseFloat(item.harga_myr.replace("RM", "")), 0);
  const jumlahAkhir = jumlahProduk + wrappingCost + shippingCost;
  const jumlahAkhirSGD = jumlahAkhir / 3.3;

  document.getElementById("hargaProduk").textContent = `RM${jumlahProduk.toFixed(2)}`;
  document.getElementById("hargaWrapping").textContent = `RM${wrappingCost.toFixed(2)}`;
  document.getElementById("hargaWrappingSGD").textContent = `S$${wrappingCostSGD.toFixed(2)}`;
  document.getElementById("hargaPenghantaran").textContent = `RM${shippingCost.toFixed(2)}`;
  document.getElementById("hargaPenghantaranSGD").textContent = `S$${shippingCostSGD.toFixed(2)}`;
  document.getElementById("jumlahAkhir").textContent = `RM${jumlahAkhir.toFixed(2)}`;
  document.getElementById("jumlahAkhirSGD").textContent = `S$${jumlahAkhirSGD.toFixed(2)}`;
  document.getElementById("summaryHarga").classList.remove("hidden");
}

  document.addEventListener("DOMContentLoaded", () => {
    kiraJumlahAkhirPaparan();


  document.getElementById("wrapping").addEventListener("change", kiraJumlahAkhirPaparan);
  document.getElementById("penghantaran").addEventListener("change", kiraJumlahAkhirPaparan);

});

  </script>

  <script>
  function setLanguage(lang) {
    localStorage.setItem('language', lang);

    document.querySelectorAll('[data-lang-my]').forEach(el => {
      el.textContent = el.getAttribute(`data-lang-${lang}`);
    });
  }

  // Apply saved language on load
  document.addEventListener("DOMContentLoaded", () => {
    
    const lang = localStorage.getItem('language') || 'my';
    setLanguage(lang);
  });
</script>

</body>
</html>
